<!DOCTYPE html>
<html lang="en">

<head>
    <title>Minesweeper</title>
    <meta charset="UTF-8">

    <link rel="stylesheet" href="style.css">

    <script src="wasm_exec.js"></script>
    <script src="elm.js"></script>
    <script>
        const wasmLoadEvent = new Event("wasm-load");

        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
            go.run(result.instance);

            dispatchEvent(wasmLoadEvent);
        });
    </script>
</head>

<body>
    <div id="elm-app-is-loaded-here"></div>

    <script>
        // Only after wasm loaded then can call its func so needs to wait for that.
        addEventListener("wasm-load", () => {
            var app = Elm.Main.init({
                node: document.getElementById("elm-app-is-loaded-here")
            });

            app.ports.newGame.subscribe(function (dim_obj) {
                const { rowsNum, colsNum } = dim_obj;

                console.log("cols:", colsNum, "rows:", rowsNum);

                const mines = newMines(rowsNum, colsNum);
                app.ports.minesGetter.send(mines);

                const grid = newGrid(rowsNum, colsNum);
                app.ports.gridGetter.send(grid);
            });
        });
    </script>
</body>

</html>